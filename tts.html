<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8" />
    <title>VOICEVOX éŸ³å£°åˆæˆ</title>
    <style>
        body {
            font-family: sans-serif;
            padding: 20px;
        }

        #result {
            margin-top: 10px;
            font-size: 1.1em;
            color: #333;
        }

        button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            background: #007bff;
            color: white;
        }

        button:disabled {
            background: #999;
            cursor: not-allowed;
        }
    </style>
</head>

<body>
    <h2>VOICEVOX éŸ³å£°åˆæˆãƒ‡ãƒ¢</h2>
    <input id="proxyIP" type="text" value="136.117.237.126" style="width:300px; padding:5px;">
    </br>
    <input id="text" type="text" value="ã“ã‚“ã«ã¡ã¯" style="width:300px; padding:5px;">
    <button id="playBtn" onclick="synthesizeVoice()">â–¶ å†ç”Ÿ</button>
    <div id="result">å¾…æ©Ÿä¸­...</div>

    <script>
        async function synthesizeVoice() {
            const proxyIP = document.getElementById('proxyIP').value;
            const apiBase = `http://${proxyIP}:3000`;
            const text = document.getElementById('text').value;
            const speaker = 1;
            const resultEl = document.getElementById('result');
            const playBtn = document.getElementById('playBtn');

            playBtn.disabled = true;
            resultEl.textContent = "ğŸ” Audio Query å–å¾—ä¸­...";

            try {
                const queryResponse = await fetch(`${apiBase}/api/audio_query`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text, speaker })
                });
                const queryData = await queryResponse.json();

                resultEl.textContent = "ğŸ™ï¸ éŸ³å£°åˆæˆä¸­...";
                const synthesisResponse = await fetch(`${apiBase}/api/synthesis`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ speaker, queryData })
                });

                const audioBlob = await synthesisResponse.blob();
                const audioURL = URL.createObjectURL(audioBlob);
                const audio = new Audio(audioURL);
                resultEl.textContent = "â–¶ å†ç”Ÿä¸­...";
                audio.play();

                audio.addEventListener('ended', () => {
                    resultEl.textContent = "âœ… å†ç”Ÿå®Œäº†";
                    playBtn.disabled = false;
                });

            } catch (error) {
                resultEl.textContent = "âŒ ã‚¨ãƒ©ãƒ¼ï¼š" + error.message;
                playBtn.disabled = false;
            }
        }
    </script>
</body>

</html>